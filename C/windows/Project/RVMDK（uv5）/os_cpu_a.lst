ARM GAS  ../../source/src/user/OS_CPU/OS_CPU_A.s 			page 1


   1              	    
   2              	    .global  OSTCBCurPtr
   3              	    .global  OSTCBHighRdyPtr
   4              	
   5              	    .global  _estack
   6              	                                    
   7              	    .global  OS_CPU_PendSVHandler
   8              	
   9              	    .cpu    cortex-m3
  10              	    .fpu    softvfp
  11              	    .syntax unified
  12              	    .thumb
  13              	    .text
  14              	
  15              	    .equ NVIC_INT_CTRL,0xE000ED04
  16              	    .equ NVIC_SYSPRI14,0xE000ED22
  17              	    .equ NVIC_PENDSV_PRI,0xFF
  18              	    .equ NVIC_PENDSVSET,0x10000000
  19              	
  20              	    .global OSStartHighRdy
  21              	    .type OSStartHighRdy, %function
  22              	OSStartHighRdy:
  23 0000 1248     	    LDR     R0, =NVIC_SYSPRI14             /*; Set the PendSV exception priority*/
  24 0002 4FF0FF01 	    LDR     R1, =NVIC_PENDSV_PRI
  25 0006 0170     	    STRB    R1, [R0];
  26              	
  27 0008 0020     	    MOVS    R0, #0                         /* Set the PSP to 0 for initial context switch call*/
  28 000a 80F30988 	    MSR     PSP, R0
  29              	
  30 000e 1048     	    LDR     R0, =NVIC_INT_CTRL             /*; Trigger the PendSV exception (causes context switch)
  31 0010 4FF08051 	    LDR     R1, =NVIC_PENDSVSET
  32 0014 0160     	    STR     R1, [R0]
  33              	
  34 0016 62B6     	    CPSIE   I                              /*; Enable interrupts at processor level*/
  35              		
  36              	OSStartHang:
  37 0018 FEE7     	    B       OSStartHang                    /*; Should never get here*/
  38              	
  39              	    .global OS_CPU_PendSVHandler
  40              	    .type OS_CPU_PendSVHandler, %function
  41              	
  42              	OS_CPU_PendSVHandler:
  43 001a 72B6     	    CPSID   I                                                  /* ; Prevent interruption during con
  44              	
  45 001c EFF30980 	    MRS     R0, PSP                                            /* ; PSP is process stack pointer*/
  46 0020 28B1     	    CBZ     R0, OS_CPU_PendSVHandler_nosave                    /* ; Skip register save the first ti
  47              	
  48 0022 2038     	    SUBS    R0, R0, #0x20                                       /*; Save remaining regs r4-11 on pr
  49 0024 80E8F00F 	    STM     R0, {R4-R11}
  50              	
  51 0028 0A49     	    LDR     R1, =OSTCBCurPtr  /* ; OSTCBCurPtr->OSTCBStkPtr = SP;*/
  52 002a 0968     	    LDR     R1, [R1]
  53 002c 0860     	    STR     R0, [R1]   /* ; R0 is SP of process being switched out*/
  54              	                                                               
  55              	OS_CPU_PendSVHandler_nosave:
  56              	
  57 002e 0948     	    LDR     R0, =OSTCBCurPtr
ARM GAS  ../../source/src/user/OS_CPU/OS_CPU_A.s 			page 2


  58 0030 0949     	    LDR     R1, =OSTCBHighRdyPtr
  59 0032 0A68     	    LDR     R2, [R1]
  60 0034 0260     	    STR     R2, [R0]
  61              	
  62 0036 1068     	    LDR     R0, [R2] /*; R0 is new process SP; SP = OSTCBHighRdyPtr->StkPtr;*/
  63 0038 90E8F00F 	    LDM     R0, {R4-R11}                                        
  64 003c 2030     	    ADDS    R0, R0, #0x20
  65              	
  66 003e 80F30988 	    MSR     PSP, R0                                           
  67 0042 4EF0040E 	    ORR     LR, LR, #0x04                                      
  68 0046 62B6     	    CPSIE   I
  69              	
  70 0048 7047     	    BX      LR                                                 
  71              	
  72 004a 000022ED 	    /*END*/
  72      00E004ED 
  72      00E00000 
  72      00000000 
  72      0000
ARM GAS  ../../source/src/user/OS_CPU/OS_CPU_A.s 			page 3


DEFINED SYMBOLS
../../source/src/user/OS_CPU/OS_CPU_A.s:42     .text:0000001a OS_CPU_PendSVHandler
../../source/src/user/OS_CPU/OS_CPU_A.s:15     *ABS*:e000ed04 NVIC_INT_CTRL
../../source/src/user/OS_CPU/OS_CPU_A.s:16     *ABS*:e000ed22 NVIC_SYSPRI14
../../source/src/user/OS_CPU/OS_CPU_A.s:17     *ABS*:000000ff NVIC_PENDSV_PRI
../../source/src/user/OS_CPU/OS_CPU_A.s:18     *ABS*:10000000 NVIC_PENDSVSET
../../source/src/user/OS_CPU/OS_CPU_A.s:22     .text:00000000 OSStartHighRdy
../../source/src/user/OS_CPU/OS_CPU_A.s:23     .text:00000000 $t
../../source/src/user/OS_CPU/OS_CPU_A.s:36     .text:00000018 OSStartHang
../../source/src/user/OS_CPU/OS_CPU_A.s:55     .text:0000002e OS_CPU_PendSVHandler_nosave
../../source/src/user/OS_CPU/OS_CPU_A.s:72     .text:0000004a $d
../../source/src/user/OS_CPU/OS_CPU_A.s:72     .text:0000004c $d

UNDEFINED SYMBOLS
OSTCBCurPtr
OSTCBHighRdyPtr
_estack
